language: node_js
node_js:
- '8'

#- '10'
#- '11'

os:
  - linux

#  - windows

cache: 'npm'

install:
- npm install
- npm install -g gulp

#script:
#- npm run bootstrap-deps
#- npm run build
#- npm run test:ci
#- npm run test:lint


#- git config --global user.email "bitbucket-bot@applicature.com"
#- git config --global user.name "Bitbucket Bot"

jobs:
  include:
  - script: bin/test.sh
  - stage: report
    script: npm run test:sonar
  - stage: release-alpha
    if: branch != master
    script: ./bin/release-patch.sh
  - stage: release-patch
    if: branch = master
    script: ./bin/release.sh

services:
- mongodb

before_install:
  - pip install --user codecov
after_success:
  - codecov --file coverage/lcov.info --disable search
